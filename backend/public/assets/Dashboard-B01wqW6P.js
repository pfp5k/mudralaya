import{r as i,j as e,a as j}from"./index-CihYj6yJ.js";const f=u=>{if(!u)return"-";const a=new Date(u);return Number.isNaN(a.getTime())?u:a.toLocaleString()},L=()=>{const[a,m]=i.useState(null),[r,o]=i.useState(!1),[h,l]=i.useState(""),[g,v]=i.useState("contacts"),[k,N]=i.useState(""),[w,y]=i.useState(""),[p,d]=i.useState(""),b=async(s=p)=>{if(s){o(!0),l("");try{const t=await j("/api/dashboard",{includeCredentials:!0});m(t)}catch(t){l(t.data?.error||t.message||"Failed to load dashboard"),t.status===401&&(d(""),m(null))}finally{o(!1)}}};i.useEffect(()=>{(async()=>{o(!0),l("");try{const t=await j("/api/admin/session",{includeCredentials:!0});d("active"),m(null),l(""),v("contacts"),setTimeout(()=>{b("active")},0),N(t.user||"")}catch{d("")}finally{o(!1)}})()},[]);const S=s=>{s.preventDefault(),(async()=>{o(!0),l("");try{await j("/api/admin/login",{method:"POST",data:{username:k,password:w},includeCredentials:!0}),d("active"),m(null),l(""),y(""),b("active")}catch(n){l(n.data?.error||n.message||"Login failed"),d("")}finally{o(!1)}})()},C=()=>{(async()=>{try{await j("/api/admin/logout",{method:"POST",includeCredentials:!0})}catch{}d(""),N(""),y(""),m(null),l("")})()},x=[{id:"contacts",title:"Contact Requests",count:a?.counts?.contacts||0,columns:[{key:"fullName",label:"Name"},{key:"email",label:"Email"},{key:"phoneNumber",label:"Phone"},{key:"subject",label:"Subject"},{key:"occupation",label:"Occupation"},{key:"qualification",label:"Qualification"},{key:"createdAt",label:"Created",format:f}],rows:a?.contacts||[]},{id:"join",title:"Join Requests",count:a?.counts?.joinRequests||0,columns:[{key:"fullName",label:"Name"},{key:"mobileNumber",label:"Mobile"},{key:"emailId",label:"Email"},{key:"profession",label:"Profession"},{key:"dateOfBirth",label:"DOB"},{key:"createdAt",label:"Created",format:f}],rows:a?.joinRequests||[]},{id:"advisor",title:"Advisor Applications",count:a?.counts?.advisorApplications||0,columns:[{key:"fullName",label:"Name"},{key:"mobileNumber",label:"Mobile"},{key:"emailId",label:"Email"},{key:"profession",label:"Profession"},{key:"irdaLicense",label:"IRDAI"},{key:"dateOfBirth",label:"DOB"},{key:"createdAt",label:"Created",format:f}],rows:a?.advisorApplications||[]},{id:"newsletter",title:"Newsletter Subs",count:a?.counts?.newsletterSubscriptions||0,columns:[{key:"email",label:"Email"},{key:"createdAt",label:"Created",format:f}],rows:a?.newsletterSubscriptions||[]}],c=x.find(s=>s.id===g)||x[0];return e.jsxs("div",{className:"container py-5 dashboard-page",children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1",children:"Submissions Dashboard"}),e.jsx("p",{className:"text-muted mb-0",children:"Excel-style sheets for each form."})]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:b,disabled:r,children:r?"Refreshing...":"Refresh"})]}),!p&&e.jsx("div",{className:"card login-card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title mb-3",children:"Admin Login"}),h&&e.jsx("div",{className:"alert alert-danger py-2",children:h}),e.jsxs("form",{className:"row g-2",onSubmit:S,children:[e.jsx("div",{className:"col-12 col-md-4",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Username",value:k,onChange:s=>N(s.target.value),required:!0})}),e.jsx("div",{className:"col-12 col-md-4",children:e.jsx("input",{type:"password",className:"form-control",placeholder:"Password",value:w,onChange:s=>y(s.target.value),required:!0})}),e.jsx("div",{className:"col-12 col-md-4 d-flex align-items-center",children:e.jsx("button",{className:"btn btn-primary w-100",type:"submit",disabled:r,children:r?"Signing in...":"Sign in"})})]})]})}),p&&e.jsxs(e.Fragment,{children:[h&&e.jsx("div",{className:"alert alert-danger",children:h}),r&&e.jsx("div",{className:"text-center my-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status"})}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row g-3 mb-3",children:x.map(s=>e.jsx("div",{className:"col-6 col-md-3",children:e.jsx("div",{className:"card stat-card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"text-muted mb-1",children:s.title}),e.jsx("h4",{className:"mb-0",children:s.count})]})})},s.id))}),e.jsx("div",{className:"sheet-tabs",children:x.map(s=>e.jsxs("button",{type:"button",className:`sheet-tab ${g===s.id?"active":""}`,onClick:()=>v(s.id),children:[e.jsx("span",{className:"sheet-title",children:s.title}),e.jsx("span",{className:"sheet-count badge",children:s.count})]},s.id))}),e.jsxs("div",{className:"sheet-surface",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center sheet-header",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:c.title}),e.jsxs("small",{className:"text-muted",children:["Rows: ",c.rows.length]})]}),e.jsx("div",{className:"text-muted small",children:"Auto-refresh via Refresh button"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:b,disabled:r,children:r?"Refreshing...":"Refresh"}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:C,children:"Logout"})]})]}),e.jsx("div",{className:"table-responsive sheet-table",children:e.jsxs("table",{className:"table table-sm mb-0 align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"row-number-col",children:"#"}),c.columns.map(s=>e.jsx("th",{children:s.label},s.key))]})}),e.jsxs("tbody",{children:[c.rows.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:c.columns.length+1,className:"text-center text-muted",children:"No records yet"})}),c.rows.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"row-number-col text-muted",children:t+1}),c.columns.map(n=>e.jsx("td",{children:n.format?n.format(s[n.key],s):s[n.key]||"-"},n.key))]},s._id||t))]})]})})]})]})]})]})};export{L as default};
